<?php
/** @var $block \Improntus\MachPay\Block\Order\Pay */
?>
<div class="mach-wrapper">
    <div class="mach-degrade"></div>
    <div class="general-cont">
        <div class="left-cont">
            <div class="mach-cont-title">
                <h2 class="mach-call-to"><?= $block->escapeHtml(__('Pay with your App'))?></h2>
                <div class="mach-logo"></div>
            </div>

            <div class="mach-info">
                <p class="mach-text"><?= $block->escapeHtml(__('Amount payable:'))?></p>
                <p class="mach-price">$ <?= $block->escapeHtml($block->getData('amount'))?></p>
                <p class="mach-text"><?= $block->escapeHtml(__('You are paying in:'))?></p>
                <p class="mach-company"><?= $block->escapeHtml($block->getData('company_name'))?></p>
                <div class="mach-steps">
                    <ul>
                        <li><p class="mach-text" id="step-1"><?= $block->escapeHtml(__('Open your app and select "pay with QR"'))?></p></li>
                        <li><p class="mach-text" id="step-2"><?= $block->escapeHtml(__('Scan the QR code on this screen'))?></p></li>
                        <li><p class="mach-text" id="step-3"><?= $block->escapeHtml(__('Confirm the payment'))?></p></li>
                    </ul>
                </div>
            </div>

        </div>

        <div class="right-cont">
            <p class="mach-text-qr"><?= $block->escapeHtml(__('Open your MACH app and scan the QR code'))?></p>
            <!-- BOTON MOBILE -->

            <div class="button-container-url">
                <button class="mach-url-button" id="machpay-url-button" onclick="">
                    <?= $block->escapeHtml(__('Open MACH and pay'))?>
                </button>
            </div>

            <div class="mach-accordion accordion">
                <div class="title">
                    <h4><?= $block->escapeHtml(__('See payment QR'))?></h4>
                </div>
                <div class="content container qr">
                    <img src="<?= $block->escapeHtml($block->getData('qr'))?>" alt="">
                </div>
            </div>

            <!-- FIN BOTON MOBILE -->
        </div>
    </div>
    <div class="button-container">
        <button class="cancel-button" id="machpay-cancel-payment"
                onclick="location.href='<?= $block->escapeUrl($block->getUrl('machpay/order/cancel', ['_query' => ['token' => $block->getData('token')]]))?>';">
            <?= $block->escapeHtml(__('Reject payment and return'))?>
    </div>
</div>
<script type="text/x-magento-init">
    {
        "*": {
            "Improntus_MachPay/js/machpay-validation": {
                "token": "<?= $block->escapeHtml($block->getData('token'))?>",
                "ajaxUrl": "<?=$block->escapeUrl($block->getUrl('machpay/order/validation'))?>"
            }
        }
    }
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        var accordions = document.querySelectorAll(".mach-accordion.accordion");

        accordions.forEach(function (accordion) {
        accordion.classList.add("accordion");
        initializeAccordion(accordion);
        });
    });

    function initializeAccordion(element) {
        element.addEventListener('click', function () {
        element.classList.toggle("active");
        if (!element.classList.contains("active")) {
            var allAccordions = document.querySelectorAll('.accordion');
            allAccordions.forEach(function (otherAccordion) {
            if (otherAccordion !== element) {
                otherAccordion.classList.remove("active");
            }
            });
        }
        });
    }

</script>
